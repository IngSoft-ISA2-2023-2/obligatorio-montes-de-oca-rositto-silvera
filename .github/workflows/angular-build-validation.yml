name: Angular GitHub CI 

on:
    push:
        branches:
        - main
        - pipeline

jobs:
    ci:
        runs-on: ubuntu-latest
            
        strategy:
            matrix:
                node-version: [10.x, 12.x]

        steps:
        -   name: checkout
            uses: actions/checkout@v2

        -   name: Use Node.js
            uses: actions/setup-node@v1
            with:
                node-version: $18.16.0

        -   name: Cache node modules
            id: cache-nodemodules
            uses: actions/cache@v2
            env:
                cache-name: cache-node-modules
            with:
                path: Codigo/Frontend/node_modules
                key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                    ${{ runner.os }}-build-${{ env.cache-name }}-
                    ${{ runner.os }}-build-
                    ${{ runner.os }}-

        -   name: Install Dependencies
            if: steps.cache-nodemodules.outputs.cache-hit != 'true'
            run: npm ci

        -   name: Build
            run: npm run build -- --prod

        -   name: Lint
            run: npm run lint

        -   name: Test
            run: npm run test -- --prod

